stages:
  - validate
  - build

validate_mr_title:
  stage: validate
  image: alpine:latest
  script:
    - |
      echo "üîç Checking Merge Request title format..."
      TITLE="$CI_MERGE_REQUEST_TITLE"

      # Expected format: CXBOX-XXXX | Fix. / Added. and then text
      if [[ ! "$TITLE" =~ ^CXBOX-[0-9]+\ \|\ (Fix|Added)\.\ [A-Z].+ ]]; then
        echo "‚ùå Error: Invalid Merge Request title format."
        echo ""
        echo "‚öôÔ∏è The correct format should be:"
        echo "  CXBOX-1234 | Fix. Fixed login issue"
        echo "  CXBOX-5678 | Added. Implemented new API endpoint"
        echo ""
        echo "Please ensure that:"
        echo "  ‚Ä¢ It starts with the ticket number (CXBOX-1234)"
        echo "  ‚Ä¢ Followed by space, vertical bar, and space: ' | '"
        echo "  ‚Ä¢ Then one of the words: Fix. or Added."
        echo "  ‚Ä¢ Then description starts with a capital letter."
        exit 1
      fi

      echo "‚úÖ Merge Request title format is valid."
  only:
    - merge_requests

build_job:
  stage: build
  script:
    - echo "Building project..."
  dependencies:
    - validate_mr_title
